<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘ä»¬çš„æ—…è¡Œè¶³è¿¹ | é±¼ä¸æµ·çš„äºŒäººä¸–ç•Œ</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/album.css">
    <style>
        /* å›¾ç‰‡æ”¾å¤§å¼¹çª—æ ·å¼ - æ ¸å¿ƒä¼˜åŒ–å¡é¡¿ */
        .photo-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw; /* è§†å£å®½åº¦ï¼Œé¿å…æ»šåŠ¨æ¡å½±å“ */
            height: 100vh; /* è§†å£é«˜åº¦ï¼Œé“ºæ»¡å±å¹• */
            background: rgba(0, 0, 0, 0.9);
            z-index: 1001;
            display: none;
            justify-content: center;
            align-items: center;
            overflow: hidden; /* ç¦æ­¢å¼¹çª—å†…æ»šåŠ¨ */
            touch-action: none; /* ç§»åŠ¨ç«¯ç¦æ­¢è§¦æ‘¸æ»‘åŠ¨ */
            will-change: opacity; /* å‘Šè¯‰æµè§ˆå™¨æå‰ä¼˜åŒ–æ¸²æŸ“ */
        }

        .photo-viewer-content {
            max-width: 95%;
            max-height: 95%;
            width: auto;
            height: auto;
            object-fit: contain; /* å›¾ç‰‡å®Œæ•´æ˜¾ç¤ºï¼Œä¸å˜å½¢ */
            transform: translateZ(0); /* å¼€å¯ç¡¬ä»¶åŠ é€Ÿï¼Œä¸æ»‘æ¸²æŸ“ */
            image-rendering: optimizeQuality; /* ä¼˜åŒ–å›¾ç‰‡æ¸²æŸ“è´¨é‡ */
            /* å›¾ç‰‡åŠ è½½è¿‡æ¸¡ï¼Œé¿å…çªç„¶å‡ºç° */
            opacity: 0;
            transition: opacity 0.2s ease-out;
        }

        /* å›¾ç‰‡åŠ è½½å®Œæˆåæ˜¾ç¤ºè¿‡æ¸¡ */
        .photo-viewer-content.loaded {
            opacity: 1;
        }

        .photo-viewer-close {
            position: fixed; /* å›ºå®šä½ç½®ï¼Œä¸éšå›¾ç‰‡ä½ç§» */
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1002; /* é«˜äºå›¾ç‰‡ï¼Œä¸è¢«é®æŒ¡ */
            transition: color 0.2s ease; /* ä¸æ»‘hoveræ•ˆæœ */
        }

        .photo-viewer-close:hover {
            color: #ccc;
        }

        /* ç›¸å†Œç…§ç‰‡æ ·å¼ - ä¿ç•™ä¸æ»‘æ‚¬æµ®ç¼©æ”¾ */
        .album-photo {
            transition: transform 0.3s ease-out; /* æ›´å¿«æ›´ä¸æ»‘çš„è¿‡æ¸¡ */
            will-change: transform; /* æå‰ä¼˜åŒ–æ¸²æŸ“ */
            backface-visibility: hidden; /* é¿å…ç¼©æ”¾æ—¶çš„æ¨¡ç³Š/å¡é¡¿ */
        }

        /* æ‚¬æµ®è½»å¾®ç¼©æ”¾ï¼Œä¸å¤¸å¼ ï¼Œæ›´ä¸æ»‘ */
        .album-photo:hover {
            transform: scale(1.02); /* å°å¹…åº¦ç¼©æ”¾ï¼Œå‡å°‘æ€§èƒ½å¼€é”€ */
        }

        /* åŠ è½½å¤±è´¥çš„ç…§ç‰‡å–æ¶ˆäº¤äº’ */
        .album-photo[alt*="åŠ è½½å¤±è´¥"] {
            cursor: default;
            transform: none !important;
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ ï¼ˆç›¸å†Œé¡µé«˜äº®ï¼‰ -->
    <nav class="nav-bar">
        <a href="index.html">é¦–é¡µ</a>
        <a href="chat.html">èŠå¤©è®°å½•</a>
        <a href="album.html" class="active">æˆ‘ä»¬çš„ç›¸å†Œ</a>
        <a href="diary.html">æ‹çˆ±æ—¥è®°</a>
        <a href="wish.html">æ„¿æœ›æ¸…å•</a>
        <a href="message.html">å°ç•™è¨€æ¿</a>
        <a href="plan.html">æœªæ¥è®¡åˆ’</a>
    </nav>

    <!-- é¡µé¢æ ‡é¢˜ -->
    <h1 class="page-title">ğŸ—ºï¸ æˆ‘ä»¬çš„æ—…è¡Œè¶³è¿¹</h1>

    <!-- æ ¸å¿ƒï¼šä¸­å›½åœ°å›¾+åŸå¸‚æ ‡æ³¨ -->
    <!-- æ ¸å¿ƒï¼šä¸­å›½åœ°å›¾+åŸå¸‚æ ‡æ³¨ -->
    <div class="map-container">
        <!-- ä¸­å›½åœ°å›¾èƒŒæ™¯ -->
        <img src="images/map/china-map.png" alt="ä¸­å›½åœ°å›¾" class="china-map">

        <!-- ä¸‰äºšï¼šæ·±è“è‰² -->
        <div class="city-marker deep-blue" data-city="sanya" style="top: 90%; left: 61%;">
            <span class="city-name">ä¸‰äºš</span>
        </div>
        <!-- å¤©æ´¥ï¼šæ·±è“è‰² -->
        <div class="city-marker deep-blue" data-city="tianjin" style="top: 36%; left: 73%;">
            <span class="city-name">å¤©æ´¥</span>
        </div>
        <!-- å¤§è¿ï¼šæ·±è“è‰² -->
        <div class="city-marker deep-blue" data-city="dalian" style="top: 36%; left: 81.5%;">
            <span class="city-name">å¤§è¿</span>
        </div>
        <!-- é•¿æ²™ï¼šæ·±è“è‰² -->
        <div class="city-marker deep-blue" data-city="changsha" style="top: 67%; left: 66%;">
            <span class="city-name">é•¿æ²™</span>
        </div>
        <!-- æ­¦æ±‰ï¼šæ·±è“è‰² -->
        <div class="city-marker deep-blue" data-city="wuhan" style="top: 61%; left: 67%;">
            <span class="city-name">æ­¦æ±‰</span>
        </div>
        <!-- è¥¿åŒç‰ˆçº³ï¼šæ·±è“è‰² -->
        <div class="city-marker deep-blue" data-city="xishuangbanna" style="top: 80%; left: 43%;">
            <span class="city-name">ç‰ˆçº³</span>
        </div>
        <!-- æ˜†æ˜ï¼šæ·±è“è‰² -->
        <div class="city-marker deep-blue" data-city="kunming" style="top: 75%; left: 47%;">
            <span class="city-name">æ˜†æ˜</span>
        </div>
        <!-- éƒ‘å·ï¼šæ·±è“è‰² -->
        <div class="city-marker deep-blue" data-city="zhengzhou" style="top: 51%; left: 66%;">
            <span class="city-name">éƒ‘å·</span>
        </div>
        <!-- ç¢å¿ï¼šæ·±è“è‰² -->
        <div class="city-marker deep-blue" data-city="suixian" style="top: 51%; left: 70%;">
            <span class="city-name">ç¢å¿</span>
        </div>
        <!-- ä¸Šæµ·ï¼šæ·±è“è‰² -->
        <div class="city-marker deep-blue" data-city="shanghai" style="top: 58%; left: 82%;">
            <span class="city-name">ä¸Šæµ·</span>
        </div>
        <!-- æ­å·ï¼šæ·±è“è‰² -->
        <div class="city-marker deep-blue" data-city="hangzhou" style="top: 62%; left: 79%;">
            <span class="city-name">æ­å·</span>
        </div>
    </div>

    <!-- ç›¸å†Œå¼¹çª—ï¼ˆé»˜è®¤éšè—ï¼‰ -->
    <div class="album-modal" id="albumModal">
        <span class="close-btn" onclick="closeAlbumModal()">&times;</span>
        <h2 class="modal-title" id="modalTitle">ä¸‰äºšæ—…è¡Œç›¸å†Œ</h2>
        <div class="album-photos" id="albumPhotos"></div>
    </div>

    <!-- å¼¹çª—é®ç½©ï¼ˆé»˜è®¤éšè—ï¼‰ -->
    <div class="modal-mask" id="modalMask" onclick="closeAlbumModal()"></div>

    <!-- å›¾ç‰‡æ”¾å¤§å¼¹çª— -->
    <div class="photo-viewer" id="photoViewer">
        <span class="photo-viewer-close" onclick="closePhotoViewer()">&times;</span>
        <img class="photo-viewer-content" id="viewerImage" src="" alt="æ”¾å¤§çš„ç…§ç‰‡">
    </div>

    <!-- è„šæœ¬ï¼šä¼˜åŒ–äº¤äº’é€»è¾‘ï¼Œä¿è¯ä¸æ»‘ -->
    <script>
        // ===================== é…ç½®åŒºï¼ˆæ— éœ€ä¿®æ”¹ï¼‰=====================
        const cityPhotos = {
            // ä¸‰äºš 17 å¼ 
            sanya: [
                "images/travel/sanya/sanya_1.jpg",
                "images/travel/sanya/sanya_2.jpg",
                "images/travel/sanya/sanya_3.jpg",
                "images/travel/sanya/sanya_4.jpg",
                "images/travel/sanya/sanya_5.jpg",
                "images/travel/sanya/sanya_6.jpg",
                "images/travel/sanya/sanya_7.jpg",
                "images/travel/sanya/sanya_8.jpg",
                "images/travel/sanya/sanya_9.jpg",
                "images/travel/sanya/sanya_10.jpg",
                "images/travel/sanya/sanya_11.jpg",
                "images/travel/sanya/sanya_12.jpg",
                "images/travel/sanya/sanya_13.jpg",
                "images/travel/sanya/sanya_14.jpg",
                "images/travel/sanya/sanya_15.jpg",
                "images/travel/sanya/sanya_16.jpg",
                "images/travel/sanya/sanya_17.jpg"
            ],
            // å¤©æ´¥ 5 å¼ 
            tianjin: [
                "images/travel/tianjin/tianjin_1.jpg",
                "images/travel/tianjin/tianjin_2.jpg",
                "images/travel/tianjin/tianjin_3.jpg",
                "images/travel/tianjin/tianjin_4.jpg",
                "images/travel/tianjin/tianjin_5.jpg"
            ],
            // å¤§è¿ 11 å¼ 
            dalian: [
                "images/travel/dalian/dalian_1.jpg",
                "images/travel/dalian/dalian_2.jpg",
                "images/travel/dalian/dalian_3.jpg",
                "images/travel/dalian/dalian_4.jpg",
                "images/travel/dalian/dalian_5.jpg",
                "images/travel/dalian/dalian_6.jpg",
                "images/travel/dalian/dalian_7.jpg",
                "images/travel/dalian/dalian_8.jpg",
                "images/travel/dalian/dalian_9.jpg",
                "images/travel/dalian/dalian_10.jpg",
                "images/travel/dalian/dalian_11.jpg"
            ],
            // é•¿æ²™ 10 å¼ 
            changsha: [
                "images/travel/changsha/changsha_1.jpg",
                "images/travel/changsha/changsha_2.jpg",
                "images/travel/changsha/changsha_3.jpg",
                "images/travel/changsha/changsha_4.jpg",
                "images/travel/changsha/changsha_5.jpg",
                "images/travel/changsha/changsha_6.jpg",
                "images/travel/changsha/changsha_7.jpg",
                "images/travel/changsha/changsha_8.jpg",
                "images/travel/changsha/changsha_9.jpg",
                "images/travel/changsha/changsha_10.jpg"
            ],
            // æ­¦æ±‰ 7 å¼ 
            wuhan: [
                "images/travel/wuhan/wuhan_1.jpg",
                "images/travel/wuhan/wuhan_2.jpg",
                "images/travel/wuhan/wuhan_3.jpg",
                "images/travel/wuhan/wuhan_4.jpg",
                "images/travel/wuhan/wuhan_5.jpg",
                "images/travel/wuhan/wuhan_6.jpg",
                "images/travel/wuhan/wuhan_7.jpg"
            ],
            // è¥¿åŒç‰ˆçº³ 15 å¼ 
            xishuangbanna: [
                "images/travel/xishuangbanna/xishuangbanna_1.jpg",
                "images/travel/xishuangbanna/xishuangbanna_2.jpg",
                "images/travel/xishuangbanna/xishuangbanna_3.jpg",
                "images/travel/xishuangbanna/xishuangbanna_4.jpg",
                "images/travel/xishuangbanna/xishuangbanna_5.jpg",
                "images/travel/xishuangbanna/xishuangbanna_6.jpg",
                "images/travel/xishuangbanna/xishuangbanna_7.jpg",
                "images/travel/xishuangbanna/xishuangbanna_8.jpg",
                "images/travel/xishuangbanna/xishuangbanna_9.jpg",
                "images/travel/xishuangbanna/xishuangbanna_10.jpg",
                "images/travel/xishuangbanna/xishuangbanna_11.jpg",
                "images/travel/xishuangbanna/xishuangbanna_12.jpg",
                "images/travel/xishuangbanna/xishuangbanna_13.jpg",
                "images/travel/xishuangbanna/xishuangbanna_14.jpg",
                "images/travel/xishuangbanna/xishuangbanna_15.jpg"
            ],
            // æ˜†æ˜ 13 å¼ 
            kunming: [
                "images/travel/kunming/kunming_1.jpg",
                "images/travel/kunming/kunming_2.jpg",
                "images/travel/kunming/kunming_3.jpg",
                "images/travel/kunming/kunming_4.jpg",
                "images/travel/kunming/kunming_5.jpg",
                "images/travel/kunming/kunming_6.jpg",
                "images/travel/kunming/kunming_7.jpg",
                "images/travel/kunming/kunming_8.jpg",
                "images/travel/kunming/kunming_9.jpg",
                "images/travel/kunming/kunming_10.jpg",
                "images/travel/kunming/kunming_11.jpg",
                "images/travel/kunming/kunming_12.jpg",
                "images/travel/kunming/kunming_13.jpg"
            ],
            // éƒ‘å· 3 å¼ 
            zhengzhou: [
                "images/travel/zhengzhou/zhengzhou_1.jpg",
                "images/travel/zhengzhou/zhengzhou_2.jpg",
                "images/travel/zhengzhou/zhengzhou_3.jpg"
            ],
            // ç¢å¿ 3 å¼ 
            suixian: [
                "images/travel/suixian/suixian_1.jpg",
                "images/travel/suixian/suixian_2.jpg",
                "images/travel/suixian/suixian_3.jpg"
            ],
            // ä¸Šæµ· 11 å¼ 
            shanghai: [
                "images/travel/shanghai/shanghai_1.jpg",
                "images/travel/shanghai/shanghai_2.jpg",
                "images/travel/shanghai/shanghai_3.jpg",
                "images/travel/shanghai/shanghai_4.jpg",
                "images/travel/shanghai/shanghai_5.jpg",
                "images/travel/shanghai/shanghai_6.jpg",
                "images/travel/shanghai/shanghai_7.jpg",
                "images/travel/shanghai/shanghai_8.jpg",
                "images/travel/shanghai/shanghai_9.jpg",
                "images/travel/shanghai/shanghai_10.jpg",
                "images/travel/shanghai/shanghai_11.jpg"
            ],
            // æ­å· 10 å¼ 
            hangzhou: [
                "images/travel/hangzhou/hangzhou_1.jpg",
                "images/travel/hangzhou/hangzhou_2.jpg",
                "images/travel/hangzhou/hangzhou_3.jpg",
                "images/travel/hangzhou/hangzhou_4.jpg",
                "images/travel/hangzhou/hangzhou_5.jpg",
                "images/travel/hangzhou/hangzhou_6.jpg",
                "images/travel/hangzhou/hangzhou_7.jpg",
                "images/travel/hangzhou/hangzhou_8.jpg",
                "images/travel/hangzhou/hangzhou_9.jpg",
                "images/travel/hangzhou/hangzhou_10.jpg"
            ]
        };

        const cityNames = {
            sanya: "ä¸‰äºš",
            tianjin: "å¤©æ´¥",
            dalian: "å¤§è¿",
            changsha: "é•¿æ²™",
            wuhan: "æ­¦æ±‰",
            xishuangbanna: "è¥¿åŒç‰ˆçº³",
            kunming: "æ˜†æ˜",
            zhengzhou: "éƒ‘å·",
            suixian: "ç¢å¿",
            shanghai: "ä¸Šæµ·",
            hangzhou: "æ­å·"
        };
        // ================================================================

        // ç¼“å­˜é¢„åŠ è½½çš„å›¾ç‰‡ï¼Œé¿å…é‡å¤åŠ è½½
        const preloadedImages = new Map();

        // æ‰“å¼€ç›¸å†Œå¼¹çª—
        function openAlbumModal(cityKey) {
            document.getElementById('albumModal').style.display = 'block';
            document.getElementById('modalMask').style.display = 'block';
            
            document.getElementById('modalTitle').textContent = `${cityNames[cityKey]} æ—…è¡Œç›¸å†Œ`;
            
            const photosContainer = document.getElementById('albumPhotos');
            photosContainer.innerHTML = '';
            
            cityPhotos[cityKey].forEach(photo => {
                const img = document.createElement('img');
                img.src = photo;
                img.alt = `${cityNames[cityKey]}æ—…è¡Œç…§ç‰‡`;
                img.className = 'album-photo';
                
                // æå‰é¢„åŠ è½½æ”¾å¤§ç”¨çš„å›¾ç‰‡ï¼Œç¼“å­˜èµ·æ¥
                if (!preloadedImages.has(photo)) {
                    const preloadImg = new Image();
                    preloadImg.src = photo;
                    preloadedImages.set(photo, preloadImg);
                }
                
                // ç»‘å®šç‚¹å‡»æ”¾å¤§äº‹ä»¶ï¼ˆæ— å»¶è¿Ÿï¼‰
                img.onclick = function() {
                    openPhotoViewer(photo);
                };
                
                // åŠ è½½å¤±è´¥å¤„ç†
                img.onerror = function() {
                    this.alt = `${cityNames[cityKey]}ç…§ç‰‡åŠ è½½å¤±è´¥`;
                    this.style.border = '2px dashed #ff4444';
                };
                
                photosContainer.appendChild(img);
            });
        }

        // å…³é—­ç›¸å†Œå¼¹çª—
        function closeAlbumModal() {
            document.getElementById('albumModal').style.display = 'none';
            document.getElementById('modalMask').style.display = 'none';
            closePhotoViewer();
        }

        // æ‰“å¼€å›¾ç‰‡æ”¾å¤§å¼¹çª—ï¼ˆä¸æ»‘æ ¸å¿ƒï¼‰
        function openPhotoViewer(photoSrc) {
            const viewer = document.getElementById('photoViewer');
            const viewerImage = document.getElementById('viewerImage');
            
            // é‡ç½®å›¾ç‰‡çŠ¶æ€
            viewerImage.className = 'photo-viewer-content';
            viewerImage.src = ''; // å…ˆæ¸…ç©ºï¼Œé¿å…æ—§å›¾ç‰‡é—ªçƒ
            
            // ç«‹å³æ˜¾ç¤ºå¼¹çª—ï¼ˆæ— ç­‰å¾…ï¼‰
            viewer.style.display = 'flex';
            document.body.style.overflow = 'hidden';
            
            // ä½¿ç”¨ç¼“å­˜çš„é¢„åŠ è½½å›¾ç‰‡ï¼Œæ— å»¶è¿Ÿæ˜¾ç¤º
            const cachedImg = preloadedImages.get(photoSrc);
            viewerImage.src = photoSrc;
            
            // å›¾ç‰‡åŠ è½½å®Œæˆåæ·»åŠ è¿‡æ¸¡æ•ˆæœ
            viewerImage.onload = function() {
                setTimeout(() => {
                    viewerImage.classList.add('loaded');
                }, 10); // å¾®å°å»¶è¿Ÿï¼Œä¿è¯è¿‡æ¸¡ç”Ÿæ•ˆ
            };
            
            // ç¦æ­¢å›¾ç‰‡æ‹–æ‹½
            viewerImage.ondragstart = () => false;
        }

        // å…³é—­å›¾ç‰‡æ”¾å¤§å¼¹çª—
        function closePhotoViewer() {
            const viewer = document.getElementById('photoViewer');
            const viewerImage = document.getElementById('viewerImage');
            
            // å…ˆéšè—å›¾ç‰‡ï¼ˆè¿‡æ¸¡æ•ˆæœï¼‰
            viewerImage.classList.remove('loaded');
            // å»¶è¿Ÿå…³é—­å¼¹çª—ï¼Œä¿è¯è¿‡æ¸¡ä¸æ»‘
            setTimeout(() => {
                viewer.style.display = 'none';
                document.body.style.overflow = 'auto';
            }, 100);
        }

        // åˆå§‹åŒ–ç»‘å®š
        document.addEventListener('DOMContentLoaded', function() {
            // åŸå¸‚æ ‡æ³¨ç‚¹å‡»
            document.querySelectorAll('.city-marker').forEach(marker => {
                marker.addEventListener('click', function() {
                    openAlbumModal(this.dataset.city);
                });
            });

            // ESCé”®å…³é—­
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeAlbumModal();
                }
            });

            // ç‚¹å‡»å¼¹çª—ç©ºç™½å¤„å…³é—­
            document.getElementById('photoViewer').addEventListener('click', function(e) {
                if (e.target === this) {
                    closePhotoViewer();
                }
            });
        });
    </script>
</body>
</html>